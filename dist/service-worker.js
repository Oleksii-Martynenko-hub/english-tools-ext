(()=>{"use strict";var t={541:function(t,e,n){var r=this&&this.__assign||function(){return r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},r.apply(this,arguments)},o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,s){function i(t){try{a(r.next(t))}catch(t){s(t)}}function u(t){try{a(r.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,u)}a((r=r.apply(t,e||[])).next())}))},s=this&&this.__generator||function(t,e){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var u=n(503),a=n(560),c=i(n(813));console.log("from back");var l=c.default.getInstance(),f=function(t){var e=t.tabId;t.url,chrome.scripting.executeScript({target:{tabId:e},files:["./content-script.js"]})},h=function(t){t.name===a.secretKey&&t.onMessage.addListener((function(t,e){var n=t.msg,i=t.data;return o(void 0,void 0,void 0,(function(){var t,o,u,a;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,5,,6]),"event selected word"===n&&i.word?[4,l.postTranslate({text:i.word})]:[3,2];case 1:t=s.sent().data,e.postMessage({msg:"word successfully translated",data:{translate:t}}),s.label=2;case 2:return"event submit card"===n&&i.card&&e.sender?[4,l.postNewWord(r(r({},i.card),{homeURL:null===(a=e.sender)||void 0===a?void 0:a.url}))]:[3,4];case 3:o=s.sent().data,e.postMessage({msg:"card successfully added",data:{card:o}}),s.label=4;case 4:return[3,6];case 5:return u=s.sent(),console.error(u),[3,6];case 6:return[2]}}))}))}))},d=function(t){u.store.get("isLoggedIn").then((function(e){if(e.isLoggedIn){if(t)return void t();chrome.webNavigation.onCompleted.addListener(f)}}))};chrome.runtime.onInstalled.addListener((function(){return o(void 0,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),chrome.runtime.onConnect.addListener(h),[4,l.getMe()];case 1:return t.sent().data,d(),[3,3];case 2:return t.sent(),u.store.set({isLoggedIn:!1}),chrome.storage.onChanged.addListener((function(t,e){"sync"===e&&void 0!==t.isLoggedIn&&(d(),d((function(){chrome.tabs.query({currentWindow:!0,active:!0},(function(t){var e=t.length>0&&t[0].id||0;chrome.scripting.executeScript({target:{tabId:e},files:["./content-script.js"]})}))})),!1===t.isLoggedIn.newValue&&!0===t.isLoggedIn.oldValue&&(chrome.webNavigation.onCompleted.removeListener(f),chrome.runtime.onConnect.removeListener(h)))})),[3,3];case 3:return[2]}}))}))}))},571:function(t,e,n){var r,o=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__assign||function(){return s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},s.apply(this,arguments)},i=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,s){function i(t){try{a(r.next(t))}catch(t){s(t)}}function u(t){try{a(r.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,u)}a((r=r.apply(t,e||[])).next())}))},u=this&&this.__generator||function(t,e){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var c=a(n(687)),l=function(t){function e(e){var n=t.call(this,e)||this;return n.protectedPost=function(t,e,r){return void 0===r&&(r={}),i(n,void 0,void 0,(function(){return u(this,(function(n){switch(n.label){case 0:return[4,this.protectedRequest({method:"POST",route:t,body:e||null,headers:r})];case 1:return[2,n.sent()]}}))}))},n.protectedGet=function(t,e){return void 0===e&&(e={}),i(n,void 0,void 0,(function(){return u(this,(function(n){switch(n.label){case 0:return[4,this.protectedRequest({method:"GET",route:t,headers:e})];case 1:return[2,n.sent()]}}))}))},n.protectedRequest=function(t){return i(n,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return[4,this.handleRequest(this.request,t)];case 1:return[2,e.sent()]}}))}))},n.handleRequest=function(t,e){return i(n,void 0,void 0,(function(){var n,r,o;return u(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,c.default.getInstance().getAccessToken()];case 1:if(!(n=i.sent()))throw{status:400,message:"User doesn't authorize!"};return this.config.headers=s(s({},this.config.headers),{Authorization:"Bearer ".concat(n)}),[4,t(s(s({},e),{headers:this.config.headers}))];case 2:if(200===(r=i.sent()).status)return[2,r];throw{response:r};case 3:return o=i.sent(),[2,this.handleResponseError(o,t,e)];case 4:return[2]}}))}))},n.handleResponseError=function(t,e,r){return i(n,void 0,void 0,(function(){var n,o,i,a,l,f,h,d;return u(this,(function(u){switch(u.label){case 0:return n=t.response?t.response.status:null,o=null===(d=null==t?void 0:t.response)||void 0===d?void 0:d.message,[4,(i=c.default.getInstance()).getRefreshToken()];case 1:if(a=u.sent(),400!==n||"Forbidden"!==o&&"Token was expired"!==o&&"Refresh token already used"!==o&&"User doesn't authorize!"!==o||!a)return[3,7];u.label=2;case 2:return u.trys.push([2,6,,7]),[4,this.refreshTokens(a)];case 3:return(l=u.sent())?(f=l.accessToken,h=l.refreshToken,i.setAccessToken(f),i.setRefreshToken(h),this.config.headers=s(s({},this.config.headers),{Authorization:"Bearer ".concat(f)}),[4,e(s(s({},r),{headers:this.config.headers}))]):[3,5];case 4:return[2,u.sent()];case 5:return[3,7];case 6:return u.sent(),i.clear(),[2,Promise.reject(t)];case 7:return[2,Promise.reject(t)]}}))}))},n}return o(e,t),e.prototype.refreshTokens=function(t){return i(this,void 0,void 0,(function(){var e,n;return u(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,fetch(this.url+"/auth/refresh",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Bearer ".concat(t)}})];case 1:return[4,r.sent().json()];case 2:return(null==(e=r.sent())?void 0:e.data)&&(null==e?void 0:e.data.accessToken)&&(null==e?void 0:e.data.refreshToken)?[2,null==e?void 0:e.data]:[3,4];case 3:return n=r.sent(),[2,Promise.reject(n)];case 4:return[2]}}))}))},e}(a(n(430)).default);e.default=l},430:function(t,e){var n=this&&this.__assign||function(){return n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},n.apply(this,arguments)},r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,s){function i(t){try{a(r.next(t))}catch(t){s(t)}}function u(t){try{a(r.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,u)}a((r=r.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t){var e=this;this.request=function(t){var s=t.method,i=t.route,u=t.body,a=void 0===u?void 0:u,c=t.headers;return r(e,void 0,void 0,(function(){var t;return o(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,fetch(this.url+i,{method:s,body:JSON.stringify(a),headers:n(n({},this.config.headers),c)})];case 1:return[4,e.sent().json()];case 2:return[2,e.sent()];case 3:return t=e.sent(),[2,Promise.reject(t)];case 4:return[2]}}))}))},this.post=function(t,n,s){return void 0===s&&(s={}),r(e,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.request({method:"POST",route:t,body:n||null,headers:s})];case 1:return[2,e.sent()]}}))}))},this.get=function(t,n){return void 0===n&&(n={}),r(e,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.request({method:"GET",route:t,body:null,headers:n})];case 1:return[2,e.sent()]}}))}))},this.url=t,this.config={headers:{"Content-Type":"application/json;charset=UTF-8"}}}},813:function(t,e,n){var r,o=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=s(n(687)),u=s(n(571)),a=n(43),c=function(t){function e(){var e=t.call(this,a.API)||this;return e.getMe=function(){return e.protectedGet("/auth/me1")},e.getLogout=function(){return i.default.getInstance().clear()},e.postNewWord=function(t){return e.protectedPost("/card",t)},e.postTranslate=function(t){return e.protectedPost("/deepl/translate",t)},e}return o(e,t),e.getInstance=function(){return this.classInstance||(this.classInstance=new e),this.classInstance},e}(u.default);e.default=c},43:function(t,e,n){var r,o=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.API=void 0;var i=s(n(430));e.API="https:super-anki.herokuapp.com/api";var u=function(t){function n(){var n=t.call(this,e.API)||this;return n.login=function(t){return n.post("/auth/login",t)},n}return o(n,t),n.getInstance=function(){return this.classInstance||(this.classInstance=new n),this.classInstance},n}(i.default);e.default=u},503:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.store=void 0,e.store={get:function(t){return chrome.storage.sync.get(t)},set:function(t){return chrome.storage.sync.set(t)}}},953:function(t,e){var n=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,s){function i(t){try{a(r.next(t))}catch(t){s(t)}}function u(t){try{a(r.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,u)}a((r=r.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t){void 0===t&&(t=function(){return chrome.storage.sync}),this.storage=t()}return t.prototype.get=function(t){return n(this,void 0,void 0,(function(){var e,n;return r(this,(function(r){switch(r.label){case 0:return[4,this.storage.get(t)];case 1:return e=r.sent(),[2,(n={},n[t]=e[t],n)]}}))}))},t.prototype.set=function(t){return this.storage.set(t)},t.prototype.clearItem=function(t){this.storage.remove(t)},t.prototype.clearItems=function(t){var e=this;t.forEach((function(t){return e.clearItem(t)}))},t}();e.default=o},687:function(t,e,n){var r,o=this&&this.__extends||(r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},r(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,s){function i(t){try{a(r.next(t))}catch(t){s(t)}}function u(t){try{a(r.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,u)}a((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},u=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a,c=u(n(953));!function(t){t.ACCESS_TOKEN="access_token",t.REFRESH_TOKEN="refresh_token"}(a||(a={}));var l=function(t){function e(){return t.call(this)||this}return o(e,t),e.getInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.getAccessToken=function(){return s(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.get(a.ACCESS_TOKEN)];case 1:return[2,t.sent()[a.ACCESS_TOKEN]||null]}}))}))},e.prototype.setAccessToken=function(t){var e;return this.set(((e={})[a.ACCESS_TOKEN]=t,e))},e.prototype.getRefreshToken=function(){return s(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.get(a.REFRESH_TOKEN)];case 1:return[2,t.sent()[a.REFRESH_TOKEN]||null]}}))}))},e.prototype.setRefreshToken=function(t){var e;return this.set(((e={})[a.REFRESH_TOKEN]=t,e))},e.prototype.clear=function(){this.clearItems([a.ACCESS_TOKEN,a.REFRESH_TOKEN])},e}(c.default);e.default=l},560:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.messageListener=e.secretKey=void 0,e.secretKey="alsdfkjl3jf9sd3h03ru3fs90e8u3fhsdifj",e.messageListener=function(t,n,r){chrome.runtime.onMessage.addListener((function(o,s,i){if(o.secret===e.secretKey&&o.msg===t){if(n(o.data,i,s),!r)return;return!0}}))}}},e={};!function n(r){var o=e[r];if(void 0!==o)return o.exports;var s=e[r]={exports:{}};return t[r].call(s.exports,s,s.exports,n),s.exports}(541)})();